# Profile 설정
spring:
  config:
    import: ""  # prod에서는 .env 파일 안 씀

  mvc:
    async:
      request-timeout: -1   # SSE 무제한

  # 환경별로 다른 설정만
  jpa:
    hibernate:
      ddl-auto: validate  # Flyway가 스키마 관리, JPA는 검증만
    show-sql: false
    database: postgresql
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    open-in-view: false
    properties:
      hibernate:
        jdbc:
          time_zone: UTC
        temp:
          use_jdbc_metadata_defaults: false

  # 보안: 디폴트 제거
  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            redirect-uri: ${GOOGLE_REDIRECT_URI}
            # IMPORTANT: 'openid' scope는 반드시 필요 - 이게 있어야 OIDC 방식으로 처리됨 (CustomOidcUserService)
            # 'openid' scope가 없으면 일반 OAuth2로 처리되어 CustomOAuth2UserService로 라우팅되어 에러 발생
            scope:
              - openid  # 필수! Google OIDC 인증을 위해 필요
              - email
              - profile
          github:
            client-id: ${GITHUB_CLIENT_ID}
            client-secret: ${GITHUB_CLIENT_SECRET}
            redirect-uri: ${GITHUB_REDIRECT_URI}
            scope:
              - read:user
              - user:email

  flyway:
    enabled: true
    locations: classpath:db/migration
    sql-migration-prefix: V
    sql-migration-separator: __
    sql-migration-suffixes: .sql
    validate-on-migrate: true
    clean-disabled: true

springdoc:
  server-url: https://api.yaldi.kr

jwt:
  secret: ${JWT_SECRET}

server:
  tomcat:
    connection-timeout: 3600000     # 1시간
    keep-alive-timeout: 3600000     # 1시간
    max-keep-alive-requests: 10000

ai:
  server:
    url: ${AI_SERVER_URL}

frontend:
  url: ${FRONTEND_URL}

oauth2:
  authorized-redirect-uris: ${OAUTH2_REDIRECT_URIS}

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS}

cookie:
  secure: true  # SameSite=None 사용 시 필수
  same-site: None  # Cross-Site 요청에서도 쿠키 전송 허용
  domain:

# 로깅 레벨만 변경
logging:
  level:
    root: INFO
    org.springframework.messaging: INFO
    org.springframework.web.socket: INFO
