import React, { useState } from 'react';
import FilterIcon from '../../assets/icons/filter_icon.svg?react';
import { useNavigate, useParams } from 'react-router-dom';
import Pagination from '../../components/common/Pagination';
import { useDataModelStore } from '../../stores/dataModelStore';
import type { DataModelType } from '../../types/dataModel';
import { apiController } from '../../apis/apiController';
import type { ApiError } from '../../types/api';
import Swal from 'sweetalert2';

interface RelatedTable {
  "tableKey": number;
  "physicalName": string;
  "logicalName": string;
  "displayName": string;
}

interface Datamodel {
  "modelKey": number;
  "projectKey": number;
  "name": string;
  "type": "DTO_RESPONSE" | "DTO_REQUEST" | "ENTITY";
  "syncStatus": string;  // "IN_SYNC" | "OUT_OF_SYNC" | "INVALID";
  "syncMessage": string;
  "lastSyncedAt": string;
  "relatedTables": RelatedTable[];
  "columnCount": number;
  "createdAt": string;
  "updatedAt": string;
}

interface DmPageInfo {
  "page": number;
  "size": number;
  "numberOfElements": number;
  "totalElements": number;
  "totalPages": number;
  "first": boolean;
  "last": boolean;
  "empty": boolean;
  "sort": {
    "sorted": boolean;
    "unsorted": boolean;
    "empty": boolean;
  }
}

const DataModelListPage: React.FC = () => {

  const dummyPagination: DmPageInfo = {
    "page": 0,
    "size": 10,
    "numberOfElements": 5,
    "totalElements": 5,
    "totalPages": 1,
    "first": true,
    "last": true,
    "empty": false,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  }

  const dummyDataModelList: Datamodel[] = [
    {
      "modelKey": 5,
      "projectKey": 1,
      "name": "DuplicateColumnTest",
      "type": "DTO_RESPONSE",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-12T17:07:53.152001Z",
      "relatedTables": [
        {
          "tableKey": 1,
          "physicalName": "members",
          "logicalName": "회원",
          "displayName": "members (회원)"
        },
        {
          "tableKey": 2,
          "physicalName": "orders",
          "logicalName": "주문",
          "displayName": "orders (주문)"
        }
      ],
      "columnCount": 2,
      "createdAt": "2025-11-12T17:07:53.152662Z",
      "updatedAt": "2025-11-12T17:07:53.152662Z"
    },
    {
      "modelKey": 4,
      "projectKey": 1,
      "name": "OrderWithMemberResponse",
      "type": "DTO_RESPONSE",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-12T17:06:00.549883Z",
      "relatedTables": [
        {
          "tableKey": 1,
          "physicalName": "members",
          "logicalName": "회원",
          "displayName": "members (회원)"
        },
        {
          "tableKey": 2,
          "physicalName": "orders",
          "logicalName": "주문",
          "displayName": "orders (주문)"
        }
      ],
      "columnCount": 4,
      "createdAt": "2025-11-12T17:06:00.550562Z",
      "updatedAt": "2025-11-12T17:06:00.550562Z"
    },
    {
      "modelKey": 3,
      "projectKey": 1,
      "name": "MemberResponse",
      "type": "DTO_RESPONSE",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-12T17:02:39.53485Z",
      "relatedTables": [
        {
          "tableKey": 1,
          "physicalName": "members",
          "logicalName": "회원",
          "displayName": "members (회원)"
        }
      ],
      "columnCount": 3,
      "createdAt": "2025-11-12T17:02:39.535969Z",
      "updatedAt": "2025-11-12T17:02:39.535969Z"
    },
    {
      "modelKey": 2,
      "projectKey": 1,
      "name": "OrdersEntity",
      "type": "ENTITY",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-12T16:36:18.23805Z",
      "relatedTables": [
        {
          "tableKey": 2,
          "physicalName": "orders",
          "logicalName": "주문",
          "displayName": "orders (주문)"
        }
      ],
      "columnCount": 5,
      "createdAt": "2025-11-12T16:36:18.23805Z",
      "updatedAt": "2025-11-12T16:36:18.23805Z"
    },
    {
      "modelKey": 10,
      "projectKey": 1,
      "name": "MembersEntity",
      "type": "ENTITY",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-12T16:32:37.798457Z",
      "relatedTables": [
        {
          "tableKey": 1,
          "physicalName": "members",
          "logicalName": "회원",
          "displayName": "members (회원)"
        }
      ],
      "columnCount": 5,
      "createdAt": "2025-11-12T16:32:37.839904Z",
      "updatedAt": "2025-11-12T16:32:37.839904Z"
    },
    {
      "modelKey": 5,
      "projectKey": 1,
      "name": "CreateOrderRequest",
      "type": "DTO_REQUEST",
      "syncStatus": "IN_SYNC",
      "syncMessage": "동기화됨",
      "lastSyncedAt": "2025-11-14T09:30:15.123456Z",
      "relatedTables": [
        {
          "tableKey": 1,
          "physicalName": "members",
          "logicalName": "회원",
          "displayName": "members (회원)"
        },
        {
          "tableKey": 2,
          "physicalName": "orders",
          "logicalName": "주문",
          "displayName": "orders (주문)"
        }
      ],
      "columnCount": 3,
      "createdAt": "2025-11-14T09:30:15.123456Z",
      "updatedAt": "2025-11-14T09:30:15.123456Z"
    }

  ]

  const navigate = useNavigate();
  const projectKey = useParams().projectKey || 1;
  const dataModels = useDataModelStore((state) => state.dataModels);

  const PAGE_SIZE = 10;

  const [isLoading, setIsLoading] = React.useState<boolean>(false);
  const [currentPage, setCurrentPage] = React.useState<number>(1);
  const [dataModelList, setDataModelList] = React.useState<Datamodel[] | null>(null);
  const [paginationInfo, setPaginationInfo] = React.useState<DmPageInfo>({
    "page": 0,
    "size": PAGE_SIZE,
    "numberOfElements": 0,
    "totalElements": 0,
    "totalPages": 1,
    "first": true,
    "last": true,
    "empty": true,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  });

  const [filterCondition, setFilterCondition] = useState<DataModelType | 'ALL'>('ALL');


  const fetchDataModelList = React.useCallback(async (page: number, filter: string) => {
    setIsLoading(true);
    try {
      const response = await apiController({
        url: `/api/v1/projects/${encodeURIComponent(projectKey)}/data-models?page=${encodeURIComponent(page - 1)}&size=10&filter=${encodeURIComponent(filter)}`,
        method: 'get',
      });

      setDataModelList(response.data.result.data);
      setPaginationInfo(response.data.result.meta);
      console.log("데이터 목록 불러옴.", response.data.result);

    } catch (err) {
      const error = err as ApiError;

      if (error.status === 403) {
        Swal.fire({
          icon: 'warning',
          text: "이 프로젝트에 권한이 없습니다.",
          confirmButtonColor: '#1e50af',
        })
        navigate("/mypage", { replace: true });
        return;
      }

      console.log("데이터 목록 불러오기 실패:", err);
      setDataModelList(dummyDataModelList);
      setPaginationInfo(dummyPagination);

    } finally {

      setIsLoading(false);
    }
  }, [projectKey]);

  const handleItemClick = (dataModelKey: number) => {
    navigate(`/project/${projectKey}/data-model/${dataModelKey}`);
  };

  const DmTypeToIcon = (type: string) => {
    if (type === "DTO_RESPONSE") {
      return <svg width="109" height="26" viewBox="0 0 109 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="109" height="26" rx="5" fill="#CC79A7" fill-opacity="0.2" />
        <path d="M6.83398 8.10156H10.7168C11.4596 8.10156 12.0954 8.23372 12.624 8.49805C13.1572 8.76237 13.5628 9.13835 13.8408 9.62598C14.1188 10.109 14.2578 10.6764 14.2578 11.3281C14.2578 12.0026 14.1074 12.5814 13.8066 13.0645C13.5059 13.5475 13.0729 13.9098 12.5078 14.1514L14.6133 18H12.3438L10.4502 14.4863H8.88477V18H6.83398V8.10156ZM10.334 12.8184C11.5371 12.8184 12.1387 12.3216 12.1387 11.3281C12.1387 10.8223 11.9883 10.4395 11.6875 10.1797C11.3867 9.91536 10.9355 9.7832 10.334 9.7832H8.88477V12.8184H10.334ZM18.8789 18.1504C18.127 18.1504 17.4753 17.9954 16.9238 17.6855C16.377 17.3757 15.9554 16.9336 15.6592 16.3594C15.363 15.7806 15.2148 15.1016 15.2148 14.3223C15.2148 13.5612 15.3607 12.8913 15.6523 12.3125C15.9486 11.7292 16.3678 11.278 16.9102 10.959C17.4525 10.64 18.0814 10.4805 18.7969 10.4805C19.4622 10.4805 20.057 10.6217 20.5811 10.9043C21.1097 11.1823 21.5244 11.6038 21.8252 12.1689C22.1305 12.734 22.2832 13.4245 22.2832 14.2402V14.8145H17.2109C17.2109 15.1836 17.2793 15.5049 17.416 15.7783C17.5573 16.0518 17.7555 16.2637 18.0107 16.4141C18.2705 16.5599 18.5736 16.6328 18.9199 16.6328C19.2526 16.6328 19.5397 16.5667 19.7812 16.4346C20.0228 16.2979 20.196 16.1133 20.3008 15.8809H22.2285C22.1328 16.3366 21.9368 16.7354 21.6406 17.0771C21.3444 17.4189 20.9593 17.6833 20.4854 17.8701C20.016 18.057 19.4805 18.1504 18.8789 18.1504ZM20.3691 13.543C20.3691 13.2467 20.3031 12.9824 20.1709 12.75C20.0433 12.513 19.8633 12.3285 19.6309 12.1963C19.3984 12.0641 19.1341 11.998 18.8379 11.998C18.5371 11.998 18.2637 12.0664 18.0176 12.2031C17.776 12.3398 17.5824 12.5267 17.4365 12.7637C17.2952 13.0007 17.2201 13.2604 17.2109 13.543H20.3691ZM27.793 12.7773C27.752 12.5176 27.6221 12.3102 27.4033 12.1553C27.1846 11.9958 26.9089 11.916 26.5762 11.916C26.3574 11.916 26.1592 11.9502 25.9814 12.0186C25.8083 12.0824 25.6715 12.1735 25.5713 12.292C25.471 12.4059 25.4232 12.5358 25.4277 12.6816C25.4141 13.0326 25.7331 13.2786 26.3848 13.4199L27.7109 13.6934C28.431 13.8438 28.9665 14.083 29.3174 14.4111C29.6729 14.7393 29.8529 15.1699 29.8574 15.7031C29.8529 16.1862 29.7116 16.6123 29.4336 16.9814C29.1602 17.3506 28.7751 17.6377 28.2783 17.8428C27.7816 18.0479 27.2096 18.1504 26.5625 18.1504C25.9017 18.1504 25.3298 18.057 24.8467 17.8701C24.3636 17.6787 23.9831 17.4076 23.7051 17.0566C23.4316 16.7012 23.2676 16.2819 23.2129 15.7988H25.25C25.2956 16.0905 25.4323 16.3115 25.6602 16.4619C25.888 16.6123 26.1888 16.6875 26.5625 16.6875C26.9316 16.6875 27.2279 16.6169 27.4512 16.4756C27.679 16.3343 27.793 16.1452 27.793 15.9082C27.793 15.7168 27.7109 15.5618 27.5469 15.4434C27.3874 15.3203 27.1322 15.2201 26.7812 15.1426L25.5508 14.8965C24.849 14.7598 24.3158 14.5114 23.9512 14.1514C23.5866 13.7913 23.4089 13.3379 23.418 12.791C23.4134 12.3216 23.5387 11.9137 23.7939 11.5674C24.0492 11.2165 24.4137 10.9476 24.8877 10.7607C25.3617 10.5739 25.9154 10.4805 26.5488 10.4805C27.1641 10.4805 27.7018 10.5739 28.1621 10.7607C28.6224 10.9476 28.9824 11.2142 29.2422 11.5605C29.5065 11.9023 29.6569 12.3079 29.6934 12.7773H27.793ZM31.1016 10.5762H33.0977V11.8203H33.1797C33.3483 11.4466 33.6035 11.1299 33.9453 10.8701C34.2871 10.6104 34.7383 10.4805 35.2988 10.4805C35.8594 10.4805 36.3675 10.6263 36.8232 10.918C37.279 11.2051 37.639 11.6357 37.9033 12.21C38.1722 12.7796 38.3066 13.4746 38.3066 14.2949C38.3066 15.097 38.1745 15.7874 37.9102 16.3662C37.6504 16.9404 37.2926 17.3779 36.8369 17.6787C36.3857 17.9749 35.873 18.123 35.2988 18.123C34.7474 18.123 34.2985 17.9977 33.9521 17.7471C33.6104 17.4919 33.3529 17.1797 33.1797 16.8105H33.125V20.7891H31.1016V10.5762ZM33.084 14.2812C33.084 14.7279 33.1455 15.1198 33.2686 15.457C33.3916 15.7897 33.5716 16.0495 33.8086 16.2363C34.0456 16.4186 34.3281 16.5098 34.6562 16.5098C35.1621 16.5098 35.5518 16.307 35.8252 15.9014C36.1032 15.4958 36.2422 14.9557 36.2422 14.2812C36.2422 13.6159 36.1032 13.085 35.8252 12.6885C35.5518 12.292 35.1621 12.0938 34.6562 12.0938C34.1549 12.0938 33.7676 12.2897 33.4941 12.6816C33.2207 13.069 33.084 13.6022 33.084 14.2812ZM42.9551 18.1504C42.2168 18.1504 41.5742 17.9909 41.0273 17.6719C40.4805 17.3529 40.0589 16.904 39.7627 16.3252C39.4665 15.7419 39.3184 15.0697 39.3184 14.3086C39.3184 13.5475 39.4642 12.8776 39.7559 12.2988C40.0521 11.7201 40.4736 11.2734 41.0205 10.959C41.5719 10.64 42.2168 10.4805 42.9551 10.4805C43.6934 10.4805 44.3382 10.64 44.8896 10.959C45.4411 11.2734 45.8649 11.7201 46.1611 12.2988C46.4574 12.8776 46.6055 13.5475 46.6055 14.3086C46.6055 15.0697 46.4574 15.7419 46.1611 16.3252C45.8649 16.904 45.4411 17.3529 44.8896 17.6719C44.3382 17.9909 43.6934 18.1504 42.9551 18.1504ZM42.9688 16.5781C43.306 16.5781 43.5931 16.4824 43.8301 16.291C44.0671 16.0951 44.2448 15.8262 44.3633 15.4844C44.4818 15.1426 44.541 14.7507 44.541 14.3086C44.541 13.8665 44.4818 13.4746 44.3633 13.1328C44.2448 12.7865 44.0671 12.5153 43.8301 12.3193C43.5931 12.1234 43.306 12.0254 42.9688 12.0254C42.627 12.0254 42.3353 12.1234 42.0938 12.3193C41.8568 12.5153 41.6768 12.7865 41.5537 13.1328C41.4307 13.4746 41.3691 13.8665 41.3691 14.3086C41.3691 14.7461 41.4307 15.138 41.5537 15.4844C41.6768 15.8262 41.8568 16.0951 42.0938 16.291C42.3353 16.4824 42.627 16.5781 42.9688 16.5781ZM49.9004 18H47.877V10.5762H49.8047V11.875H49.8867C50.0599 11.4375 50.3402 11.0957 50.7275 10.8496C51.1149 10.6035 51.5775 10.4805 52.1152 10.4805C52.6302 10.4805 53.0814 10.5921 53.4688 10.8154C53.8561 11.0387 54.1546 11.3623 54.3643 11.7861C54.5739 12.2054 54.6764 12.6999 54.6719 13.2695V18H52.6621V13.625C52.6621 13.1693 52.5436 12.8115 52.3066 12.5518C52.0697 12.292 51.7415 12.1621 51.3223 12.1621C50.8893 12.1621 50.543 12.2988 50.2832 12.5723C50.028 12.8457 49.9004 13.224 49.9004 13.707V18ZM60.4824 12.7773C60.4414 12.5176 60.3115 12.3102 60.0928 12.1553C59.874 11.9958 59.5983 11.916 59.2656 11.916C59.0469 11.916 58.8486 11.9502 58.6709 12.0186C58.4977 12.0824 58.361 12.1735 58.2607 12.292C58.1605 12.4059 58.1126 12.5358 58.1172 12.6816C58.1035 13.0326 58.4225 13.2786 59.0742 13.4199L60.4004 13.6934C61.1204 13.8438 61.6559 14.083 62.0068 14.4111C62.3623 14.7393 62.5423 15.1699 62.5469 15.7031C62.5423 16.1862 62.401 16.6123 62.123 16.9814C61.8496 17.3506 61.4645 17.6377 60.9678 17.8428C60.471 18.0479 59.8991 18.1504 59.252 18.1504C58.5911 18.1504 58.0192 18.057 57.5361 17.8701C57.0531 17.6787 56.6725 17.4076 56.3945 17.0566C56.1211 16.7012 55.957 16.2819 55.9023 15.7988H57.9395C57.985 16.0905 58.1217 16.3115 58.3496 16.4619C58.5775 16.6123 58.8783 16.6875 59.252 16.6875C59.6211 16.6875 59.9173 16.6169 60.1406 16.4756C60.3685 16.3343 60.4824 16.1452 60.4824 15.9082C60.4824 15.7168 60.4004 15.5618 60.2363 15.4434C60.0768 15.3203 59.8216 15.2201 59.4707 15.1426L58.2402 14.8965C57.5384 14.7598 57.0052 14.5114 56.6406 14.1514C56.276 13.7913 56.0983 13.3379 56.1074 12.791C56.1029 12.3216 56.2282 11.9137 56.4834 11.5674C56.7386 11.2165 57.1032 10.9476 57.5771 10.7607C58.0511 10.5739 58.6048 10.4805 59.2383 10.4805C59.8535 10.4805 60.3913 10.5739 60.8516 10.7607C61.3118 10.9476 61.6719 11.2142 61.9316 11.5605C62.196 11.9023 62.3464 12.3079 62.3828 12.7773H60.4824ZM67.1543 18.1504C66.4023 18.1504 65.7507 17.9954 65.1992 17.6855C64.6523 17.3757 64.2308 16.9336 63.9346 16.3594C63.6383 15.7806 63.4902 15.1016 63.4902 14.3223C63.4902 13.5612 63.6361 12.8913 63.9277 12.3125C64.224 11.7292 64.6432 11.278 65.1855 10.959C65.7279 10.64 66.3568 10.4805 67.0723 10.4805C67.7376 10.4805 68.3324 10.6217 68.8564 10.9043C69.3851 11.1823 69.7998 11.6038 70.1006 12.1689C70.4059 12.734 70.5586 13.4245 70.5586 14.2402V14.8145H65.4863C65.4863 15.1836 65.5547 15.5049 65.6914 15.7783C65.8327 16.0518 66.0309 16.2637 66.2861 16.4141C66.5459 16.5599 66.849 16.6328 67.1953 16.6328C67.528 16.6328 67.8151 16.5667 68.0566 16.4346C68.2982 16.2979 68.4714 16.1133 68.5762 15.8809H70.5039C70.4082 16.3366 70.2122 16.7354 69.916 17.0771C69.6198 17.4189 69.2347 17.6833 68.7607 17.8701C68.2913 18.057 67.7559 18.1504 67.1543 18.1504ZM68.6445 13.543C68.6445 13.2467 68.5785 12.9824 68.4463 12.75C68.3187 12.513 68.1387 12.3285 67.9062 12.1963C67.6738 12.0641 67.4095 11.998 67.1133 11.998C66.8125 11.998 66.5391 12.0664 66.293 12.2031C66.0514 12.3398 65.8577 12.5267 65.7119 12.7637C65.5706 13.0007 65.4954 13.2604 65.4863 13.543H68.6445ZM75.0977 18V8.10156H78.625C79.6139 8.10156 80.4684 8.2998 81.1885 8.69629C81.9085 9.08822 82.46 9.6556 82.8428 10.3984C83.2301 11.1413 83.4238 12.0208 83.4238 13.0371C83.4238 14.0625 83.2301 14.9489 82.8428 15.6963C82.4554 16.4391 81.8994 17.0088 81.1748 17.4053C80.4502 17.8018 79.5866 18 78.584 18H75.0977ZM78.502 16.2363C79.459 16.2363 80.1768 15.9766 80.6553 15.457C81.1338 14.9375 81.373 14.1309 81.373 13.0371C81.373 11.9525 81.1338 11.1527 80.6553 10.6377C80.1813 10.1227 79.4681 9.86523 78.5156 9.86523H77.1484V16.2363H78.502ZM84.0938 8.10156H92.2012V9.79688H89.166V18H87.1289V9.79688H84.0938V8.10156ZM102.1 13.0508C102.1 14.099 101.899 15.0081 101.498 15.7783C101.097 16.5439 100.546 17.1296 99.8438 17.5352C99.1465 17.9362 98.3581 18.1367 97.4785 18.1367C96.5944 18.1367 95.8014 17.9339 95.0996 17.5283C94.3978 17.1227 93.8464 16.5371 93.4453 15.7715C93.0443 15.0013 92.8438 14.0944 92.8438 13.0508C92.8438 12.0026 93.0443 11.0957 93.4453 10.3301C93.8464 9.5599 94.3978 8.97428 95.0996 8.57324C95.8014 8.16764 96.5944 7.96484 97.4785 7.96484C98.3581 7.96484 99.1465 8.16764 99.8438 8.57324C100.546 8.97428 101.097 9.5599 101.498 10.3301C101.899 11.0957 102.1 12.0026 102.1 13.0508ZM100.008 13.0508C100.008 12.3535 99.903 11.7611 99.6934 11.2734C99.4883 10.7858 99.1966 10.4167 98.8184 10.166C98.4401 9.91081 97.9935 9.7832 97.4785 9.7832C96.9635 9.7832 96.5146 9.91081 96.1318 10.166C95.7536 10.4167 95.4596 10.7881 95.25 11.2803C95.0404 11.7679 94.9355 12.3581 94.9355 13.0508C94.9355 13.7435 95.0404 14.3359 95.25 14.8281C95.4596 15.3158 95.7536 15.6872 96.1318 15.9424C96.5146 16.193 96.9635 16.3184 97.4785 16.3184C97.9935 16.3184 98.4401 16.193 98.8184 15.9424C99.1966 15.6872 99.4883 15.3158 99.6934 14.8281C99.903 14.3405 100.008 13.748 100.008 13.0508Z" fill="#CC79A7" />
      </svg>

    } else if (type === "DTO_REQUEST") {
      return <svg width="99" height="26" viewBox="0 0 99 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="99" height="26" rx="5" fill="#009E73" fill-opacity="0.2" />
        <path d="M6.83398 8.10156H10.7168C11.4596 8.10156 12.0954 8.23372 12.624 8.49805C13.1572 8.76237 13.5628 9.13835 13.8408 9.62598C14.1188 10.109 14.2578 10.6764 14.2578 11.3281C14.2578 12.0026 14.1074 12.5814 13.8066 13.0645C13.5059 13.5475 13.0729 13.9098 12.5078 14.1514L14.6133 18H12.3438L10.4502 14.4863H8.88477V18H6.83398V8.10156ZM10.334 12.8184C11.5371 12.8184 12.1387 12.3216 12.1387 11.3281C12.1387 10.8223 11.9883 10.4395 11.6875 10.1797C11.3867 9.91536 10.9355 9.7832 10.334 9.7832H8.88477V12.8184H10.334ZM18.8789 18.1504C18.127 18.1504 17.4753 17.9954 16.9238 17.6855C16.377 17.3757 15.9554 16.9336 15.6592 16.3594C15.363 15.7806 15.2148 15.1016 15.2148 14.3223C15.2148 13.5612 15.3607 12.8913 15.6523 12.3125C15.9486 11.7292 16.3678 11.278 16.9102 10.959C17.4525 10.64 18.0814 10.4805 18.7969 10.4805C19.4622 10.4805 20.057 10.6217 20.5811 10.9043C21.1097 11.1823 21.5244 11.6038 21.8252 12.1689C22.1305 12.734 22.2832 13.4245 22.2832 14.2402V14.8145H17.2109C17.2109 15.1836 17.2793 15.5049 17.416 15.7783C17.5573 16.0518 17.7555 16.2637 18.0107 16.4141C18.2705 16.5599 18.5736 16.6328 18.9199 16.6328C19.2526 16.6328 19.5397 16.5667 19.7812 16.4346C20.0228 16.2979 20.196 16.1133 20.3008 15.8809H22.2285C22.1328 16.3366 21.9368 16.7354 21.6406 17.0771C21.3444 17.4189 20.9593 17.6833 20.4854 17.8701C20.016 18.057 19.4805 18.1504 18.8789 18.1504ZM20.3691 13.543C20.3691 13.2467 20.3031 12.9824 20.1709 12.75C20.0433 12.513 19.8633 12.3285 19.6309 12.1963C19.3984 12.0641 19.1341 11.998 18.8379 11.998C18.5371 11.998 18.2637 12.0664 18.0176 12.2031C17.776 12.3398 17.5824 12.5267 17.4365 12.7637C17.2952 13.0007 17.2201 13.2604 17.2109 13.543H20.3691ZM28.4629 16.8105H28.3945C28.2214 17.1797 27.9639 17.4919 27.6221 17.7471C27.2803 17.9977 26.8359 18.123 26.2891 18.123C25.7148 18.123 25.1999 17.9749 24.7441 17.6787C24.2884 17.3779 23.9284 16.9404 23.6641 16.3662C23.3997 15.7874 23.2676 15.097 23.2676 14.2949C23.2676 13.4746 23.402 12.7796 23.6709 12.21C23.9398 11.6357 24.3021 11.2051 24.7578 10.918C25.2181 10.6263 25.7285 10.4805 26.2891 10.4805C26.8496 10.4805 27.2985 10.6104 27.6357 10.8701C27.973 11.1299 28.2259 11.4466 28.3945 11.8203H28.4902V10.5762H30.4863V20.7891H28.4629V16.8105ZM26.918 16.5098C27.2507 16.5098 27.5355 16.4186 27.7725 16.2363C28.0094 16.0495 28.1895 15.7897 28.3125 15.457C28.4401 15.1198 28.5039 14.7279 28.5039 14.2812C28.5039 13.6068 28.3649 13.0736 28.0869 12.6816C27.8089 12.2897 27.4193 12.0938 26.918 12.0938C26.4167 12.0938 26.0293 12.292 25.7559 12.6885C25.4824 13.085 25.3457 13.6159 25.3457 14.2812C25.3457 14.9557 25.4824 15.4958 25.7559 15.9014C26.0293 16.307 26.4167 16.5098 26.918 16.5098ZM36.8301 10.5762H38.8535V18H36.9121V16.6602H36.8301C36.6523 17.1022 36.3675 17.4531 35.9756 17.7129C35.5882 17.9681 35.1211 18.0957 34.5742 18.0957C34.0775 18.0957 33.64 17.984 33.2617 17.7607C32.888 17.5374 32.5964 17.2161 32.3867 16.7969C32.1771 16.373 32.0723 15.8763 32.0723 15.3066V10.5762H34.0957V14.9512C34.0957 15.3887 34.2119 15.7373 34.4443 15.9971C34.6813 16.2568 34.998 16.3867 35.3945 16.3867C35.6497 16.3867 35.8867 16.3275 36.1055 16.209C36.3242 16.0859 36.4997 15.9082 36.6318 15.6758C36.764 15.4434 36.8301 15.1654 36.8301 14.8418V10.5762ZM43.7891 18.1504C43.0371 18.1504 42.3854 17.9954 41.834 17.6855C41.2871 17.3757 40.8656 16.9336 40.5693 16.3594C40.2731 15.7806 40.125 15.1016 40.125 14.3223C40.125 13.5612 40.2708 12.8913 40.5625 12.3125C40.8587 11.7292 41.278 11.278 41.8203 10.959C42.3626 10.64 42.9915 10.4805 43.707 10.4805C44.3724 10.4805 44.9671 10.6217 45.4912 10.9043C46.0199 11.1823 46.4346 11.6038 46.7354 12.1689C47.0407 12.734 47.1934 13.4245 47.1934 14.2402V14.8145H42.1211C42.1211 15.1836 42.1895 15.5049 42.3262 15.7783C42.4674 16.0518 42.6657 16.2637 42.9209 16.4141C43.1807 16.5599 43.4837 16.6328 43.8301 16.6328C44.1628 16.6328 44.4499 16.5667 44.6914 16.4346C44.9329 16.2979 45.1061 16.1133 45.2109 15.8809H47.1387C47.043 16.3366 46.847 16.7354 46.5508 17.0771C46.2546 17.4189 45.8695 17.6833 45.3955 17.8701C44.9261 18.057 44.3906 18.1504 43.7891 18.1504ZM45.2793 13.543C45.2793 13.2467 45.2132 12.9824 45.0811 12.75C44.9535 12.513 44.7734 12.3285 44.541 12.1963C44.3086 12.0641 44.0443 11.998 43.748 11.998C43.4473 11.998 43.1738 12.0664 42.9277 12.2031C42.6862 12.3398 42.4925 12.5267 42.3467 12.7637C42.2054 13.0007 42.1302 13.2604 42.1211 13.543H45.2793ZM52.7031 12.7773C52.6621 12.5176 52.5322 12.3102 52.3135 12.1553C52.0947 11.9958 51.819 11.916 51.4863 11.916C51.2676 11.916 51.0693 11.9502 50.8916 12.0186C50.7184 12.0824 50.5817 12.1735 50.4814 12.292C50.3812 12.4059 50.3333 12.5358 50.3379 12.6816C50.3242 13.0326 50.6432 13.2786 51.2949 13.4199L52.6211 13.6934C53.3411 13.8438 53.8766 14.083 54.2275 14.4111C54.583 14.7393 54.763 15.1699 54.7676 15.7031C54.763 16.1862 54.6217 16.6123 54.3438 16.9814C54.0703 17.3506 53.6852 17.6377 53.1885 17.8428C52.6917 18.0479 52.1198 18.1504 51.4727 18.1504C50.8118 18.1504 50.2399 18.057 49.7568 17.8701C49.2738 17.6787 48.8932 17.4076 48.6152 17.0566C48.3418 16.7012 48.1777 16.2819 48.123 15.7988H50.1602C50.2057 16.0905 50.3424 16.3115 50.5703 16.4619C50.7982 16.6123 51.099 16.6875 51.4727 16.6875C51.8418 16.6875 52.138 16.6169 52.3613 16.4756C52.5892 16.3343 52.7031 16.1452 52.7031 15.9082C52.7031 15.7168 52.6211 15.5618 52.457 15.4434C52.2975 15.3203 52.0423 15.2201 51.6914 15.1426L50.4609 14.8965C49.7591 14.7598 49.2259 14.5114 48.8613 14.1514C48.4967 13.7913 48.319 13.3379 48.3281 12.791C48.3236 12.3216 48.4489 11.9137 48.7041 11.5674C48.9593 11.2165 49.3239 10.9476 49.7979 10.7607C50.2718 10.5739 50.8255 10.4805 51.459 10.4805C52.0742 10.4805 52.612 10.5739 53.0723 10.7607C53.5326 10.9476 53.8926 11.2142 54.1523 11.5605C54.4167 11.9023 54.5671 12.3079 54.6035 12.7773H52.7031ZM59.9219 12.0938H58.5273V15.7168C58.5273 15.9902 58.5866 16.1816 58.7051 16.291C58.8236 16.4004 58.9967 16.4596 59.2246 16.4688C59.5163 16.4688 59.7852 16.4551 60.0312 16.4277V18.0273C59.7897 18.0729 59.4297 18.0957 58.9512 18.0957C58.1901 18.0957 57.5908 17.9202 57.1533 17.5693C56.7158 17.2184 56.4993 16.6966 56.5039 16.0039V12.0938H55.4785V10.5762H56.5039V8.79883H58.5273V10.5762H59.9219V12.0938ZM64.4609 18V8.10156H67.9883C68.9772 8.10156 69.8317 8.2998 70.5518 8.69629C71.2718 9.08822 71.8232 9.6556 72.2061 10.3984C72.5934 11.1413 72.7871 12.0208 72.7871 13.0371C72.7871 14.0625 72.5934 14.9489 72.2061 15.6963C71.8187 16.4391 71.2627 17.0088 70.5381 17.4053C69.8135 17.8018 68.9499 18 67.9473 18H64.4609ZM67.8652 16.2363C68.8223 16.2363 69.54 15.9766 70.0186 15.457C70.4971 14.9375 70.7363 14.1309 70.7363 13.0371C70.7363 11.9525 70.4971 11.1527 70.0186 10.6377C69.5446 10.1227 68.8314 9.86523 67.8789 9.86523H66.5117V16.2363H67.8652ZM73.457 8.10156H81.5645V9.79688H78.5293V18H76.4922V9.79688H73.457V8.10156ZM91.4629 13.0508C91.4629 14.099 91.2624 15.0081 90.8613 15.7783C90.4603 16.5439 89.9089 17.1296 89.207 17.5352C88.5098 17.9362 87.7214 18.1367 86.8418 18.1367C85.9577 18.1367 85.1647 17.9339 84.4629 17.5283C83.7611 17.1227 83.2096 16.5371 82.8086 15.7715C82.4076 15.0013 82.207 14.0944 82.207 13.0508C82.207 12.0026 82.4076 11.0957 82.8086 10.3301C83.2096 9.5599 83.7611 8.97428 84.4629 8.57324C85.1647 8.16764 85.9577 7.96484 86.8418 7.96484C87.7214 7.96484 88.5098 8.16764 89.207 8.57324C89.9089 8.97428 90.4603 9.5599 90.8613 10.3301C91.2624 11.0957 91.4629 12.0026 91.4629 13.0508ZM89.3711 13.0508C89.3711 12.3535 89.2663 11.7611 89.0566 11.2734C88.8516 10.7858 88.5599 10.4167 88.1816 10.166C87.8034 9.91081 87.3568 9.7832 86.8418 9.7832C86.3268 9.7832 85.8779 9.91081 85.4951 10.166C85.1169 10.4167 84.8229 10.7881 84.6133 11.2803C84.4036 11.7679 84.2988 12.3581 84.2988 13.0508C84.2988 13.7435 84.4036 14.3359 84.6133 14.8281C84.8229 15.3158 85.1169 15.6872 85.4951 15.9424C85.8779 16.193 86.3268 16.3184 86.8418 16.3184C87.3568 16.3184 87.8034 16.193 88.1816 15.9424C88.5599 15.6872 88.8516 15.3158 89.0566 14.8281C89.2663 14.3405 89.3711 13.748 89.3711 13.0508Z" fill="#009E73" />
      </svg>

    } else if (type === "ENTITY") {
      return <svg width="51" height="26" viewBox="0 0 51 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="51" height="26" rx="5" fill="#56B4E9" fill-opacity="0.2" />
        <path d="M6.83398 8.10156H13.4785V9.79688H8.88477V12.2031H13.1367V13.8984H8.88477V16.3047H13.4922V18H6.83398V8.10156ZM17.0605 18H15.0371V10.5762H16.9648V11.875H17.0469C17.2201 11.4375 17.5003 11.0957 17.8877 10.8496C18.2751 10.6035 18.7376 10.4805 19.2754 10.4805C19.7904 10.4805 20.2415 10.5921 20.6289 10.8154C21.0163 11.0387 21.3148 11.3623 21.5244 11.7861C21.734 12.2054 21.8366 12.6999 21.832 13.2695V18H19.8223V13.625C19.8223 13.1693 19.7038 12.8115 19.4668 12.5518C19.2298 12.292 18.9017 12.1621 18.4824 12.1621C18.0495 12.1621 17.7031 12.2988 17.4434 12.5723C17.1882 12.8457 17.0605 13.224 17.0605 13.707V18ZM27.3145 12.0938H25.9199V15.7168C25.9199 15.9902 25.9792 16.1816 26.0977 16.291C26.2161 16.4004 26.3893 16.4596 26.6172 16.4688C26.9089 16.4688 27.1777 16.4551 27.4238 16.4277V18.0273C27.1823 18.0729 26.8223 18.0957 26.3438 18.0957C25.5827 18.0957 24.9834 17.9202 24.5459 17.5693C24.1084 17.2184 23.8919 16.6966 23.8965 16.0039V12.0938H22.8711V10.5762H23.8965V8.79883H25.9199V10.5762H27.3145V12.0938ZM28.5859 10.5762H30.6094V18H28.5859V10.5762ZM29.5977 9.60547C29.3971 9.60547 29.2103 9.5599 29.0371 9.46875C28.8685 9.37305 28.734 9.24772 28.6338 9.09277C28.5381 8.93327 28.4902 8.76237 28.4902 8.58008C28.4902 8.39323 28.5381 8.22005 28.6338 8.06055C28.734 7.90104 28.8685 7.77572 29.0371 7.68457C29.2103 7.58887 29.3971 7.54102 29.5977 7.54102C29.7936 7.54102 29.9759 7.58887 30.1445 7.68457C30.3132 7.77572 30.4453 7.90104 30.541 8.06055C30.6413 8.22005 30.6914 8.39323 30.6914 8.58008C30.6914 8.76237 30.6413 8.93327 30.541 9.09277C30.4453 9.24772 30.3132 9.37305 30.1445 9.46875C29.9759 9.5599 29.7936 9.60547 29.5977 9.60547ZM36.0918 12.0938H34.6973V15.7168C34.6973 15.9902 34.7565 16.1816 34.875 16.291C34.9935 16.4004 35.1667 16.4596 35.3945 16.4688C35.6862 16.4688 35.9551 16.4551 36.2012 16.4277V18.0273C35.9596 18.0729 35.5996 18.0957 35.1211 18.0957C34.36 18.0957 33.7607 17.9202 33.3232 17.5693C32.8857 17.2184 32.6693 16.6966 32.6738 16.0039V12.0938H31.6484V10.5762H32.6738V8.79883H34.6973V10.5762H36.0918V12.0938ZM38.5527 20.7891C38.1289 20.7891 37.7871 20.7754 37.5273 20.748V19.1758C37.8737 19.194 38.1471 19.2031 38.3477 19.2031C38.5072 19.2031 38.6393 19.1895 38.7441 19.1621C38.8535 19.1348 38.9561 19.071 39.0518 18.9707C39.152 18.8704 39.2409 18.7201 39.3184 18.5195L39.4414 18.2051L36.7754 10.5762H38.8945L40.4531 16.0449H40.5352L42.1074 10.5762H44.2539L41.3555 18.8203C41.1322 19.4538 40.7972 19.9391 40.3506 20.2764C39.904 20.6182 39.3047 20.7891 38.5527 20.7891Z" fill="#56B4E9" />
      </svg>


    } else {
      return null;
    }
  }


  React.useEffect(() => {
    // 데이터모델 목록 조회 api
    fetchDataModelList(currentPage, filterCondition);


  }, [currentPage, filterCondition, fetchDataModelList]);

  return (
    <div className="relative flex flex-col w-10/12  max-w-[1187.5px] justify-self-center justify-center content-center items-center py-4 gap-4 text-my-black">
      {/* 상단 제목 및 필터 */}
      <div className="flex flex-col w-full justify-start gap-[5px]">
        <div className="text-xl font-bold">데이터 모델</div>
        <div className="flex w-full justify-start gap-[5px] items-center">
          <FilterIcon />
          <select
            className="text-sm bg-white border border-my-border rounded-[10px] px-[10px] py-[5px] focus:outline-2"
            name="filterConditionSelect"
            id="filterConditionSelect"
            value={filterCondition}
            onChange={(e) => {
              const value = e.target.value as DataModelType | 'ALL';
              setFilterCondition(value);
              setCurrentPage(1);
            }}
            disabled={dataModels.length === 0}
          >
            <option value="ALL">전체</option>
            <option value="ENTITY">Entity</option>
            <option value="DTO_RESPONSE">Response DTO</option>
            <option value="DTO_REQUEST">Request DTO</option>
          </select>
        </div>
      </div>

      {/* 목록 */}
      <div className="w-full border border-my-border rounded-2xl p-1">
        <table className="w-full border-separate border-spacing-y-0.5 table-fixed">
          <colgroup>
            <col style={{ width: '15%' }} /> {/* 타입 */}
            <col style={{ width: '20%' }} /> {/* 이름 */}
            <col style={{ width: '25%' }} /> {/* 설명 */}
            <col style={{ width: '20%' }} /> {/* 관련 엔티티 */}
            <col style={{ width: '20%' }} /> {/* 생성일 */}
          </colgroup>

          <thead className="text-md fond-semibold ">
            <tr>
              <th
                className="p-3 text-left border-b border-my-border"
                scope="col"
              >
                타입
              </th>
              <th
                className="p-3 text-left border-b border-my-border"
                scope="col"
              >
                이름
              </th>
              <th
                className="p-3 text-left border-b border-my-border"
                scope="col"
              >
                상태
              </th>
              <th
                className="p-3 text-left border-b border-my-border"
                scope="col"
              >
                관련 테이블
              </th>
              <th
                className="p-3 text-left border-b border-my-border"
                scope="col"
              >
                생성일
              </th>
            </tr>
          </thead>

          <tbody className="text-sm">
            {isLoading ?
              (
                // 스피너
                <tr>
                  <td colSpan={5} className="p-3 text-center">
                    <div className='flex justify-center'>
                      <svg aria-hidden="true" className="w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill='#CFCFCF' />
                        <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill='#1E50AF' />
                      </svg>
                      <span className="sr-only">Loading...</span>
                    </div>
                  </td>
                </tr>
              ) : !dataModelList || dataModelList.length === 0 ? (
                <tr>
                  <td colSpan={5} className="p-3 text-center">
                    데이터가 없습니다.
                  </td>
                </tr>
              ) : (
                dataModelList.map((item) => (
                  <tr
                    onClick={() => handleItemClick(item.modelKey)}
                    key={item.modelKey}
                    className="h-[44px] hover:bg-light-blue cursor-pointer"
                  >
                    <td className="p-3 text-left rounded-l-xl truncate">
                      {DmTypeToIcon(item.type)}
                    </td>
                    <td className="p-3 text-left truncate">{item.name}</td>
                    <td className="p-3 text-left truncate">{item.syncMessage}</td>
                    <td className="p-3 text-left truncate">
                      {(item.relatedTables.map((table) => (table.displayName))).join(', ')}
                    </td>
                    <td className="p-3 text-left rounded-r-xl truncate">
                      {new Date(item.createdAt).toLocaleDateString()}
                    </td>
                  </tr>
                ))
              )}
          </tbody>
        </table>
      </div>

      {/* 페이지네이션 */}
      {
        paginationInfo.totalElements > 0 && (
          <Pagination
            totalPages={paginationInfo.totalPages}
            currentPage={currentPage}
            onPageChange={(page: number) => setCurrentPage(page)}
            className="absolute top-[645px]"
          />
        )
      }

    </div >
  );
};

export default DataModelListPage;
