카테고리,설명,비고,버전
인증 방식,"JWT (JSON Web Token) + 쿠키 전달
Access Token: 15분 (짧게)
Refresh Token: 7일 (길게)
알고리즘: RS256 (비대칭키)
전달 방식: HttpOnly 쿠키 (XSS 방어)
OAuth 2.0 & OIDC 지원",,
JWT 쿠키 설정,"쿠키명: access_token, refresh_token
HttpOnly: true (JavaScript 접근 불가)
Secure: true (HTTPS 전용)
SameSite: Strict (CSRF 방지)
Domain: .yaldi.io
Path: / (access_token), /api/v1/auth/refresh (refresh_token)",,
JWT 검증 절차,"1. 쿠키에서 JWT 추출
2. Signature 검증 (서버 비밀키로)
3. Payload 확인 (exp, iss, aud 등)
4. Refresh Token은 Redis Blacklist 확인
5. DB 조회 없이 인증 완료 (병목 완화)",,
RBAC 권한 모델,"Owner: 모든 권한 (삭제, 멤버 관리)
Editor: 읽기/쓰기 (ERD 편집, 버전 생성)
Viewer: 읽기 전용",,
Permission 체계,"project:read/write/delete/manage_members
table:read/write/delete
column:read/write/delete
relation:read/write/delete
version:read/write",,
Audit Log,"모든 API 호출 및 데이터 변경 기록
필드: action, resourceType, resourceId, userId, ip, userAgent, timestamp, details
보존: 프로젝트 Audit Log 90일, 사용자 활동 로그 30일",,
JWT 구조,"Header: 알고리즘(RS256) 및 토큰 타입
Payload: Claims (iss, sub, exp, iat, nbf, userId, roles)
Signature: Header+Payload를 비밀키로 서명
쿠키로 전달되어 XSS 공격 방어",,
JWT 장점,"병목 완화: DB 조회 없이 인증 (connection 절감)
확장성: 서버 간 인증 정보 공유 가능
무상태: 서버에 세션 저장 불필요
동시접속 1천만 시: 약 2천만 connection 절감 효과",,
Token 갱신 전략,"웹: 만료 전 갱신 (pre-refresh, 만료 5분 전)
모바일: 만료 시 자동 갱신
Access Token: 서버에 저장 안 함
Refresh Token: Redis에 저장 (블랙리스트 관리)",,
OAuth 2.0 & OIDC,"OAuth 2.0: 인가(Authorization) - API 접근 권한 부여
OIDC (OpenID Connect): 인증(Authentication) - 사용자 신원 확인
ID Token: 사용자 정보가 담긴 JWT (이메일, 이름, 프로필 사진 등)
PKCE: 모바일/SPA 보안 강화
로그인 성공 시 JWT를 HttpOnly 쿠키로 발급",,
OIDC 흐름,"1. 사용자 구글 로그인 동의
2. Authorization Code 받음
3. 백엔드가 Code를 Access Token + ID Token으로 교환
4. ID Token에서 사용자 정보 추출 (email, name, picture 등)
5. Yaldi JWT 생성 (Access + Refresh Token)
6. JWT를 HttpOnly 쿠키로 발급
7. ID Token은 서버에서만 검증 후 폐기",,
Token 검증 API,"엔드포인트: GET /api/v1/auth/verify
쿠키에서 JWT 자동 읽기 및 검증
응답: valid, userId, username, roles, expiresAt
Token 무효/만료 시 401 Unauthorized",,
소셜 로그인 지원,"Google: OAuth 2.0 + OIDC (ID Token 포함)
GitHub: OAuth 2.0 (UserInfo API로 프로필 조회)",,
MFA (Multi-Factor Authentication),"TOTP (Time-based OTP)
SMS 인증
이메일 인증",,
Token 관리,"Access Token: 15분 유효, 서버 저장 안 함
Refresh Token: 7일 유효, Redis에 저장 (블랙리스트용)
Token Rotation: Refresh 시 새로운 Refresh Token 발급
디바이스별 Refresh Token 관리
동시 로그인 제한: 최대 5개 디바이스",,
비밀번호 재설정,"이메일 링크 방식
토큰 유효 기간: 1시간
Rate Limiting: 5 req/hour",,
계정 잠금 정책,"로그인 실패 5회: 15분 잠금
로그인 실패 10회: 1시간 잠금
로그인 실패 20회: 관리자 확인 필요",,
API Key 관리,"API Key 생성/폐기
Scope 기반 권한
만료 기간 설정
Rate Limiting: API Key별",,
CSRF 보호,"SameSite=Strict 쿠키로 CSRF 공격 방어
JWT는 HttpOnly 쿠키로만 전달 (JavaScript 접근 불가)
추가 CSRF 토큰 불필요 (SameSite로 충분)
GET 요청은 부작용 없도록 설계",,
Token 무효화,"로그아웃: POST /api/v1/auth/logout (Refresh Token 블랙리스트 추가)
전체 로그아웃: 모든 디바이스 Refresh Token 무효화
Access Token: 만료 시까지 유효 (최대 15분)
Blacklist: Redis에 Refresh Token ID 저장 (7일)",,
Refresh Token 저장,"Token ID: UUID v4 (jti claim)
저장 위치: Redis
저장 데이터: userId, deviceInfo, ipAddress, createdAt, expiresAt
인덱스: userId, jti
만료: Redis TTL 자동 삭제 (7일)",,
